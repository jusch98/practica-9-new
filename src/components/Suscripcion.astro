---
interface FormData {
  nombre: string;
  email: string;
  curso: string;
}

let formData: FormData = { nombre: "", email: "", curso: "" };
let usuarios: FormData[] = [];
let isSubscribed = false;
let showDialog = true;

// Recuperar usuarios del localStorage
if (typeof localStorage !== "undefined") {
  const storedUsers = localStorage.getItem("usuarios");
  usuarios = storedUsers ? JSON.parse(storedUsers) : [];
  if (usuarios.length > 0) {
    isSubscribed = true;
    showDialog = false; // Si ya está suscrito, no mostrar el diálogo
  }
}

const handleChange = (event: Event) => {
  const target = event.target as HTMLInputElement;
  formData[target.name] = target.value;
};

const handleSubmit = (event: Event) => {
  event.preventDefault();
  usuarios.push(formData);
  if (typeof localStorage !== "undefined") {
    localStorage.setItem("usuarios", JSON.stringify(usuarios));
  }
  isSubscribed = true;
  showDialog = false;
  formData = { nombre: "", email: "", curso: "" }; // Limpiar el formulario
};

const handleLogin = () => {
  if (usuarios && usuarios.length > 0) {
    alert(`Bienvenido, ${usuarios[0].nombre}! Has iniciado sesión.`);
    isSubscribed = true;
    showDialog = false; // Opcional: ocultar el diálogo si ya se ha "iniciado sesión"
  }
};
---

<div>
  <!-- Mostrar el diálogo si el usuario no está suscrito -->
  {showDialog && (
    <div class="fixed inset-0 bg-gray-600 bg-opacity-50 flex justify-center items-center z-50">
      <div class="bg-white p-6 rounded-lg shadow-lg">
        <h3 class="text-xl font-bold mb-4">¡Suscríbete para continuar!</h3>
        <p class="mb-4">Debes suscribirte a un curso o iniciar sesión para poder acceder a la página.</p>
        <form onsubmit={handleSubmit} class="space-y-3">
          <input
            type="text"
            name="nombre"
            value={formData.nombre}
            oninput={handleChange}
            placeholder="Nombre"
            required
            class="w-full p-2 border rounded"
          />
          <input
            type="email"
            name="email"
            value={formData.email}
            oninput={handleChange}
            placeholder="Correo Electrónico"
            required
            class="w-full p-2 border rounded"
          />
          <input
            type="text"
            name="curso"
            value={formData.curso}
            oninput={handleChange}
            placeholder="Curso de interés"
            required
            class="w-full p-2 border rounded"
          />
          <button type="submit" class="w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600">
            Suscribirse
          </button>
        </form>
      </div>
    </div>
  )}

  <!-- Mostrar el contenido de la página si está suscrito -->
  {!showDialog && (
    <div class="max-w-md mx-auto p-4 bg-white shadow-md rounded-lg">
      <h2 class="text-xl font-bold mb-4">¡Bienvenido a la Página!</h2>
      <p>Contenido disponible solo para usuarios suscritos.</p>

      <!-- Mostrar el botón de "Iniciar sesión" si el usuario no está suscrito -->
      {!isSubscribed && (
        <button
          onclick={handleLogin}
          class="w-full bg-green-500 text-white p-2 rounded hover:bg-green-600 mt-4"
        >
          Iniciar sesión
        </button>
      )}
    </div>
  )}
</div>
